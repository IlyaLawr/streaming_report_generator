# Генератор Отчётов

Утилита на Python для потоковй обработки CSV-файлов и генерации отчётов. 
На данный момент поддерживает вывод в консоль и сохранение в формате JSON.
Может быть использована для файлов с большим объемом данных.

## Возможности

- Чтение одного или нескольких CSV-файлов.
- Агрегация данных для последующей работы с ними.
- Вывод отчёта в консоль или сохранение в JSON-файл.
- Асинхронное чтение файлов и хранение в базе данных для эффективного стриминга.

## Содержание

- [Установка](#установка)
- [Структура проекта](#структура-проекта)
- [Использование](#использование)
- [Конфигурация](#конфигурация)
- [Тестирование](#тестирование)
- [Зависимости](#зависимости)
- [Лицензия](#лицензия)

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/IlyaLawr/streaming_report_generator.git
   cd StreamingReportGenerator
   ```
2. Создайте и активируйте виртуальное окружение:
   ```bash
   python3.12 -m venv venv
   source venv/bin/activate  # Для Windows: venv\Scripts\activate
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Структура проекта

```
StreamingReportGenerator/
├── src/                       # Исходный код
│   ├── main.py                # Точка входа
│   ├── settings.py            # Настройки конфигурации
│   ├── presentation/          # Форматеры CLI и выводов
│   ├── application/           # Бизнес-логика (интерфейсы, сервисы, use cases)
│   └── infrastructure/        # Реализации I/O (чтение CSV, SQLite, запись JSON)
├── data1.csv                  # Тестовые примеры CSV-файлов
├── data2.csv
├── data3.csv
├── test/                      # Тесты pytest
├── requirements.txt           # Зависимости проекта
├── pytest.ini                 # Конфигурация pytest
└── .gitignore
```

## Использование

Запустите генератор отчёта командой:

```bash
python3 main.py <CSV_ФАЙЛЫ...> --report payout --output <console|json>
```

Запуск происходит из директории с исполняемый файлом `main.py`.

- `<CSV_ФАЙЛЫ...>`: Один или несколько путей к CSV-файлам или директории с CSV.
                    Пути указываются относительно главного файла `main.py` либо абсолютные.
- `--report payout`: Тип отчёта (пока поддерживается только `payout`).
- `--output console`: Вывод в консоль.
- `--output json`: Сохранение отчёта в JSON-файл в директории `src`.
- `--report-name`: Имя файла если выбран режим сохранения в файл.

Пример, с учетом расположения тестовых файлов:

```bash
python3 main.py ../data1.csv ../data2.csv --report payout --output json
```

## Конфигурация

Настройки проекта находятся в файле `src/settings.py`:

- `base_dir`: Базовый каталог проекта.
- `db_path`: Путь к временной SQLite базе (по умолчанию `infrastructure/temp.db`).
- `file_format`: Ожидаемое расширение входных файлов (по умолчанию `.csv`).

## Тестирование

Запуск тестов с помощью pytest:

```bash
pytest
```

## Зависимости

Список зависимостей находится в `requirements.txt`:

- `aiofiles` для асинхронных операций с файлами.
- `aiosqlite` для асинхронной работы с SQLite.
- `pytest` и `pytest-asyncio` для тестирования.
